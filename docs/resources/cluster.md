---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "spirl_cluster Resource - spirl"
subcategory: ""
description: |-
  Creates a cluster within the given trust domain. When using
  Terraform, you will need to generate cluster key pairs yourself. This differs from
  cluster registration using spirlctl, which generates the key pairs for you.
  Only Edwards curves (Ed25519) are supported.
  Here's how to generate a key pair using openssl:
  
  openssl genpkey -algorithm ED25519 -out private-key.pem
  openssl pkey -pubout -in private-key.pem -out cluster-public-key.pem
  
  -> Note: The SPIRL control-plane accepts a maximum of 10 versions for a cluster.
  If the number of versions exceeds 10, the oldest version is deleted to maintain the limit.
  Agents that are using the deleted version will be unable to authenticate until they are updated to use a newer version.
---

# spirl_cluster (Resource)

Creates a cluster within the given trust domain. When using
Terraform, you will need to generate cluster key pairs yourself. This differs from
cluster registration using `spirlctl`, which generates the key pairs for you.
Only Edwards curves (Ed25519) are supported.

Here's how to generate a key pair using `openssl`:

```bash
openssl genpkey -algorithm ED25519 -out private-key.pem
openssl pkey -pubout -in private-key.pem -out cluster-public-key.pem
```
-> **Note:** The SPIRL control-plane accepts a maximum of 10 versions for a cluster.
If the number of versions exceeds 10, the oldest version is deleted to maintain the limit.
Agents that are using the deleted version will be unable to authenticate until they are updated to use a newer version.

## Example Usage

```terraform
# A cluster resource can be created for a trust domain created by Terraform.
resource "spirl_cluster" "my_cluster" {
  trust_domain_id = spirl_trust_domain.my_domain.id
  name            = "my-cluster"
  description     = "A cluster created with terraform"
  platform        = "k8s"
  public_key      = file("cluster-public-key.pem")
}

# A cluster can also be created for an existing trust domain created outside of
# Terraform by using the spirl_trust_domain data resource.
data "spirl_trust_domain" "existing_domain" {
  domain_name = "example.com"
}

resource "spirl_cluster" "my_cluster" {
  trust_domain_id = data.spirl_trust_domain.existing_domain.id
  name            = "my-cluster"
  description     = "A cluster created with terraform"
  platform        = "k8s"
  public_key      = file("cluster-public-key.pem")
}


# A cluster of linux nodes can be created by setting the platform to "linux".
# This is a node-group within spirlctl.
resource "spirl_cluster" "my_cluster" {
  trust_domain_id = spirl_trust_domain.my_domain.id
  name            = "linux-cluster"
  description     = "A nodepool cluster created with terraform"
  platform        = "linux"
  public_key      = file("cluster-public-key.pem")
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name` (String) The name of cluster
- `platform` (String) The platform of the cluster. The valid values are: k8s, istio, eks, eks-istio, linux
- `public_key` (String) The PEM formatted public key for the cluster
- `trust_domain_id` (String) The trust domain ID for the cluster

### Optional

- `cicd_profile_name` (String) The name of the CICD profile to associate with the cluster
- `description` (String) An optional description of the cluster
- `num_version_history` (Number) The number of versions to maintain for the cluster (max: 10)
- `path_template` (String) The path template for the cluster service account (e.g., /my-cluster/ns/{{kubernetes.pod.namespace}}/sa/{{kubernetes.pod.service_account}})
- `provider_attestation` (String) The name of the provider attestation configuration to use for this cluster

### Read-Only

- `created_at` (String) An RFC3339 timestamp for when the cluster was created.
- `id` (String) The unique identifier for the cluster
- `version_created_at` (String) An RFC3339 timestamp for when the cluster version was created.
- `version_id` (String) The version ID of the cluster

## Import

Import is supported using the following syntax:

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
# Clusters can be imported using a combination of the trust-domain id
# and the cluster name separated by a forward slash
# Trust Domain ID: td-123456
# Cluster Name: my-cluster-name
terraform import spirl_cluster.example "td-123456/my-cluster-name"
```
